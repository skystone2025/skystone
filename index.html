
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>SkyStone Feed v3.4.2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; margin: 0; padding: 0; background: #ffffff; }
    header { background: #f7c948; padding: 12px; text-align: center; position: relative; }
    header h1 { margin: 0; font-size: 22px; color: #000; }
    header .version { position: absolute; right: 12px; top: 12px; font-size: 14px; }
    main { padding: 20px; text-align: center; }
    label, input { font-size: 18px; margin: 5px; }
    button { padding: 10px 20px; font-size: 18px; background: #3498db; color: #fff; border: none; border-radius: 4px; }
    #result { margin-top: 20px; text-align: left; white-space: pre-wrap; background: #f4f4f4; padding: 15px; border-radius: 6px; }
  </style>
</head>
<body>
  <header>
    <h1>SkyStone 投料助手</h1>
    <div class="version">v3.4.2</div>
  </header>
  <main>
    <div>
      <label>pH: <input id="ph" type="number" step="0.1" value="7.0"></label><br>
      <label>氨氮 (NH₃): <input id="nh3" type="number" step="0.1" value="1.0"></label><br>
      <label>亚硝酸盐 (NO₂⁻): <input id="no2" type="number" step="0.1" value="0.5"></label><br>
      <label>水温 (℃): <input id="temp" type="number" step="0.1" value="28.0"></label><br><br>
      <button onclick="generate()">生成建议</button>
    </div>
    <div id="result"></div>
  </main>

  <script>
    function generate() {
      const ph = parseFloat(document.getElementById('ph').value);
      const nh3 = parseFloat(document.getElementById('nh3').value);
      const no2 = parseFloat(document.getElementById('no2').value);
      const temp = parseFloat(document.getElementById('temp').value);

      const now = new Date();
      const timestamp = now.getFullYear() + "年" + (now.getMonth()+1) + "月" + now.getDate() + "日 " + now.toLocaleTimeString();
      const id = now.toISOString().replace(/[-:T]/g, '').slice(0,14);

      let output = `【Sky Stone 投料建议】\n时间：${timestamp}\n处理ID：${id}\n\n`;
      let risk = "✅ 正常";

      if (ph > 8.5) {
        output += "❗ 当前 pH 超过 8.5，禁止使用菌剂！\n建议：换水50% + 醋酸 300ml/亩\n";
        document.getElementById("result").innerText = output;
        return;
      }

      if (no2 > 2) {
        output += "⚠️ 亚硝酸盐偏高，48小时内禁止使用糖蜜，建议使用维生素C 200g\n";
      }

      let tempFactor = temp < 20 ? 0.5 : 1.0;
      let fryFactor = 0.7;

      let molasses = nh3 * 150 * tempFactor * fryFactor;
      let bacillus = nh3 * 20 * tempFactor * fryFactor;

      if (temp < 18) {
        output += "⚠️ 当前水温低于18℃，菌剂可能失效，建议改为泼洒食盐 5KG/亩\n";
      }

      if (nh3 > 5 && temp > 28) {
        output += "⚠️ 高氨氮 + 高温 → Biofloc 溶氧风险，请开启LED灯、减喂、强增氧\n";
        risk = "❗ 高度风险";
      }

      output += `\n推荐使用：\n糖蜜 ${Math.round(molasses)}g\n枯草芽孢杆菌 ${Math.round(bacillus)}g\n`;
      output += `\n风险等级：${risk}`;
      document.getElementById("result").innerText = output;
    }
  </script>
</body>
</html>
